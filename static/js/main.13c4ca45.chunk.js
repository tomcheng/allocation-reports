(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{227:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),o=n(30),c=n.n(o),u=(n(95),n(3)),l=n.n(u),s=n(12),i=n(1),m=n(7),p=n(8),b=n(45),f=n.n(b),d=n(82),v=n.n(d),h=n(44),y=n.n(h),_=n(46),g=n.n(_),x=n(31),E=n.n(x),k=n(19),j=n.n(k),O=n(5),w=n.n(O),S=n(83),A=n.n(S),I=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=Object(a.useState)(function(){try{var n=localStorage.getItem(t);return n?JSON.parse(n):e}catch(a){return e}}),r=Object(i.a)(n,2),o=r[0],c=r[1];return[o,function(e){try{c(e),localStorage.setItem(t,JSON.stringify(e))}catch(n){console.log(n)}}]},R=null,V=null,C=n(84),M=n.n(C),B=n(32),P=n.n(B),q=function(t){return M.a.get("https://cors-anywhere.herokuapp.com/".concat(V,"v1/").concat(t),{headers:{Authorization:"Bearer ".concat(R),"Access-Control-Allow-Origin":"*"}})},T=function(){var t=Object(s.a)(l.a.mark(function t(){var e,n,a,r;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,q("accounts");case 2:return e=t.sent,n=e.data.accounts,a={},r={},t.next=8,Promise.all(n.map(function(){var t=Object(s.a)(l.a.mark(function t(e){var n,o,c,u;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([q("accounts/".concat(e.number,"/positions")),q("accounts/".concat(e.number,"/balances"))]);case 2:n=t.sent,o=Object(i.a)(n,2),c=o[0],u=o[1],r[e.number]=P()(u.data.combinedBalances,{currency:"CAD"}),a[e.number]=j()(c.data.positions,function(t){return-t.currentMarketValue});case 8:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()));case 8:return t.abrupt("return",{accounts:j()(n,function(t){return-r[t.number].totalEquity}),balances:r,positions:a});case 9:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}(),J=function(){var t=Object(s.a)(l.a.mark(function t(e){var n,a,r,o,c,u;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={},a={},t.next=4,Promise.all([q("symbols?ids=".concat(e.join(","))),q("markets/quotes?ids=".concat(e.join(",")))]);case 4:return r=t.sent,o=Object(i.a)(r,2),c=o[0],u=o[1],e.forEach(function(t){n[t]=P()(c.data.symbols,{symbolId:t}),a[t]=P()(u.data.quotes,{symbolId:t})}),t.abrupt("return",{symbols:n,quotes:a});case 10:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),z={"VEQT.TO":{stocks:1,bonds:0},"VGRO.TO":{stocks:.8,bonds:.2},"VBAL.TO":{stocks:.6,bonds:.4}},N=n(89);function U(){var t=Object(m.a)(["\n  line-height: 16px;\n  font-size: 12px;\n  color: #666;\n"]);return U=function(){return t},t}function D(){var t=Object(m.a)(["\n  display: flex;\n  justify-content: space-between;\n"]);return D=function(){return t},t}function Q(){var t=Object(m.a)(["\n  font-weight: bold;\n  font-size: 12px;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n  border-bottom: 1px solid #ddd;\n  margin-bottom: 5px;\n  margin-top: 15px;\n"]);return Q=function(){return t},t}var F=p.a.div(Q()),L=p.a.div(D()),W=p.a.div(U()),Y=function(t){return"$"+Math.round(t).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g,",")},$=function(t){var e=t.label,n=t.amount,a=t.total;return r.a.createElement(L,{style:{marginBottom:3}},r.a.createElement("div",null,r.a.createElement("div",null,e)),r.a.createElement(L,{style:{alignItems:"baseline"}},r.a.createElement("div",null,Y(n)),r.a.createElement(W,{style:{width:50,textAlign:"right"}},(n/a*100).toFixed(1)+"%")))};function G(){var t=Object(m.a)(["\n  display: flex;\n  justify-content: space-between;\n  margin-top: 40px;\n  border-bottom: 2px solid #333;\n  font-size: 18px;\n  line-height: 24px;\n  padding-bottom: 5px;\n  margin-bottom: 0;\n"]);return G=function(){return t},t}var H=p.a.h2(G()),Z=function(t){var e=t.account,n=t.balance,a=t.positions,o=t.postTaxAdjustment,c=I("__port-is-expanded-".concat(e.number,"__"),!0),u=Object(i.a)(c,2),l=u[0],s=u[1],m=w()(a,function(t){return t.currentMarketValue*z[t.symbol].stocks})*o,p=w()(a,function(t){return t.currentMarketValue*z[t.symbol].bonds})*o,b=n.cash*o,f=m+p+b;return r.a.createElement("div",{key:e.number},r.a.createElement(H,{onClick:function(){s(!l)}},r.a.createElement("span",null,e.type),r.a.createElement("span",null,Y(f))),r.a.createElement(N.a,{isExpanded:l},r.a.createElement(F,null,"Asset Classes"),r.a.createElement($,{label:"Stocks",amount:m,total:f}),r.a.createElement($,{label:"Bonds",amount:p,total:f}),r.a.createElement($,{label:"Cash",amount:b,total:f}),r.a.createElement(F,null,"Positions"),a.map(function(t){return r.a.createElement($,{key:t.symbol,label:t.symbol,amount:t.currentMarketValue*o,total:f-b})})))},K=n(87),X=n.n(K);function tt(){var t=Object(m.a)(["\n  margin-top: 0;\n  margin-bottom: 20px;\n  text-align: center;\n"]);return tt=function(){return t},t}function et(){var t=Object(m.a)(["\n  padding: 20px 30px;\n"]);return et=function(){return t},t}var nt="https://login.questrade.com/oauth2/authorize?client_id=".concat("YCUSnajluQMAHR32DnJhupUYJddjZQ","&response_type=token&redirect_uri=").concat("https://tomcheng.github.io/allocation-reports");!function(){var t=window.location.hash.substring(1).replace(/&/g,'","').replace(/=/g,'":"');if(!t)return R=localStorage.getItem("__port-token__"),void(V=localStorage.getItem("__port-api-server__"));var e=JSON.parse('{"'+t+'"}',function(t,e){return""===t?e:decodeURIComponent(e)});R=e.access_token,V=e.api_server,localStorage.setItem("__port-token__",R),localStorage.setItem("__port-api-server__",V),window.location.hash=""}();var at=p.a.div(et()),rt=p.a.h1(tt()),ot=function(){var t=I("__port-post-tax__",!0),e=Object(i.a)(t,2),n=e[0],o=e[1],c=I("__port-last-updated__",null),u=Object(i.a)(c,2),m=u[0],p=u[1],b=I("__port-accounts__",null),d=Object(i.a)(b,2),h=d[0],_=d[1],x=I("__port-balances__",{}),k=Object(i.a)(x,2),O=k[0],S=k[1],R=I("__port-positions__",{}),V=Object(i.a)(R,2),C=V[0],M=V[1],B=I("__port-symbols__",{}),P=Object(i.a)(B,2),q=P[0],N=P[1],U=I("__port-quotes__",{}),D=Object(i.a)(U,2),Q=D[0],L=D[1],W=function(){var t=Object(s.a)(l.a.mark(function t(){var e,n,a,r,o,c,u,s;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,T();case 2:return e=t.sent,n=e.accounts,a=e.balances,r=e.positions,o=A()(v()(Object.values(r)).map(function(t){return t.symbolId})),t.next=9,J(o);case 9:c=t.sent,u=c.symbols,s=c.quotes,N(u),L(s),M(r),S(a),_(n),p((new Date).getTime());case 18:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}();Object(a.useEffect)(function(){h||W()},[]);var G=function(){var t=Object(s.a)(l.a.mark(function t(){return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,_(null),t.next=4,W();case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),t.t0.message.includes("401")?window.location.href=nt:console.log(t.t0);case 9:case"end":return t.stop()}},t,null,[[0,6]])}));return function(){return t.apply(this,arguments)}}(),H=(h||[]).filter(function(t){return"RRSP"===t.type}).map(function(t){return t.number}),K=f()(Object.values(E()(C,function(t,e){return H.includes(e)}))),tt=f()(Object.values(g()(C,function(t,e){return H.includes(e)}))),et=Object.values(E()(O,function(t,e){return H.includes(e)})),ot=Object.values(g()(O,function(t,e){return H.includes(e)})),ct=n?.8:1,ut={};(h||[]).forEach(function(t){var e=n&&"RRSP"===t.type?.8:1;C[t.number].forEach(function(t){ut[t.symbol]=(ut[t.symbol]||0)+t.currentMarketValue*e})});var lt=j()(y()(ut,function(t,e){return{value:t,symbol:e}}),"value").reverse(),st=w()(K,function(t){return t.currentMarketValue*z[t.symbol].stocks})*ct,it=w()(tt,function(t){return t.currentMarketValue*z[t.symbol].stocks}),mt=w()(K,function(t){return t.currentMarketValue*z[t.symbol].bonds})*ct,pt=w()(tt,function(t){return t.currentMarketValue*z[t.symbol].bonds}),bt=w()(et,"cash")*ct,ft=w()(ot,"cash"),dt=st+it+mt+pt+bt+ft;return h?r.a.createElement(at,null,r.a.createElement("div",{style:{marginBottom:20,textAlign:"center"}},r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",checked:n,onChange:function(){o(!n)}})," ","Post tax (",20,"%)")),r.a.createElement(rt,null,Y(dt)),r.a.createElement(F,null,"Accounts"),h.map(function(t){return r.a.createElement($,{key:t.number,label:t.type,amount:O[t.number].totalEquity*("RRSP"===t.type?ct:1),total:dt})}),r.a.createElement(F,null,"Asset Classes"),r.a.createElement($,{label:"Stocks",amount:st+it,total:dt}),r.a.createElement($,{label:"Bonds",amount:mt+pt,total:dt}),r.a.createElement($,{label:"Cash",amount:bt+ft,total:dt}),r.a.createElement(F,null,"Positions"),lt.map(function(t){var e=t.value,n=t.symbol;return r.a.createElement($,{key:n,label:n,amount:e,total:dt-(bt+ft)})}),h.map(function(t){return r.a.createElement(Z,{key:t.number,account:t,balance:O[t.number],positions:C[t.number],postTaxAdjustment:"RRSP"===t.type?ct:1,symbols:q,quotes:Q})}),r.a.createElement("div",{style:{marginTop:40,textAlign:"center"}},m&&r.a.createElement("span",null,"Last Updated ",X()(m).fromNow())," ",r.a.createElement("button",{type:"button",onClick:G},"Refresh"))):r.a.createElement("a",{href:nt},"Authorize")};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(ot,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})},90:function(t,e,n){t.exports=n(227)},95:function(t,e,n){}},[[90,1,2]]]);
//# sourceMappingURL=main.13c4ca45.chunk.js.map