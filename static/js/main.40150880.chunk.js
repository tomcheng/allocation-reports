(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{227:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(30),c=n.n(o),u=(n(95),n(5)),i=n.n(u),l=n(12),s=n(1),m=n(2),d=n(3),p=n(45),b=n.n(p),f=n(82),h=n.n(f),v=n(44),g=n.n(v),y=n(46),_=n.n(y),x=n(31),E=n.n(x),k=n(19),j=n.n(k),O=n(7),w=n.n(O),R=n(83),S=n.n(R),A=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=Object(a.useState)(function(){try{var n=localStorage.getItem(e);return n?JSON.parse(n):t}catch(a){return t}}),r=Object(s.a)(n,2),o=r[0],c=r[1];return[o,function(t){try{c(t),localStorage.setItem(e,JSON.stringify(t))}catch(n){console.log(n)}}]},C=null,I=null,V=n(84),M=n.n(V),B=n(32),P=n.n(B),q=function(e){return M.a.get("https://cors-anywhere.herokuapp.com/".concat(I,"v1/").concat(e),{headers:{Authorization:"Bearer ".concat(C),"Access-Control-Allow-Origin":"*"}})},T=function(){var e=Object(l.a)(i.a.mark(function e(){var t,n,a,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q("accounts");case 2:return t=e.sent,n=t.data.accounts,a={},r={},e.next=8,Promise.all(n.map(function(){var e=Object(l.a)(i.a.mark(function e(t){var n,o,c,u;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([q("accounts/".concat(t.number,"/positions")),q("accounts/".concat(t.number,"/balances"))]);case 2:n=e.sent,o=Object(s.a)(n,2),c=o[0],u=o[1],r[t.number]=P()(u.data.combinedBalances,{currency:"CAD"}),a[t.number]=j()(c.data.positions,function(e){return-e.currentMarketValue});case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 8:return e.abrupt("return",{accounts:j()(n,function(e){return-r[e.number].totalEquity}),balances:r,positions:a});case 9:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),z=function(){var e=Object(l.a)(i.a.mark(function e(t){var n,a,r,o,c,u;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={},a={},e.next=4,Promise.all([q("symbols?ids=".concat(t.join(","))),q("markets/quotes?ids=".concat(t.join(",")))]);case 4:return r=e.sent,o=Object(s.a)(r,2),c=o[0],u=o[1],t.forEach(function(e){n[e]=P()(c.data.symbols,{symbolId:e}),a[e]=P()(u.data.quotes,{symbolId:e})}),e.abrupt("return",{symbols:n,quotes:a});case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),J={"VEQT.TO":{stocks:1,bonds:0},"VGRO.TO":{stocks:.8,bonds:.2},"VBAL.TO":{stocks:.6,bonds:.4}},N=n(89);function U(){var e=Object(m.a)(["\n  line-height: 16px;\n  font-size: 12px;\n  color: #666;\n"]);return U=function(){return e},e}function D(){var e=Object(m.a)(["\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n"]);return D=function(){return e},e}function Q(){var e=Object(m.a)(["\n  font-weight: bold;\n  font-size: 12px;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n  border-bottom: 1px solid #ccc;\n  margin-bottom: 5px;\n  margin-top: 15px;\n"]);return Q=function(){return e},e}var F=d.a.div(Q()),W=d.a.div(D()),Y=d.a.div(U()),$=function(e){var t,n=e.amount;return e.isRedacted?r.a.createElement("div",{style:{display:"inline-block",backgroundColor:"#333",width:"4em",height:"0.8em"}}):r.a.createElement("div",null,(t=n,"$"+Math.round(t).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g,",")))},G=function(e){var t=e.label,n=e.amount,a=e.total,o=e.isRedacted;return r.a.createElement(W,{style:{marginBottom:3}},r.a.createElement("div",null,r.a.createElement("div",null,t)),r.a.createElement(W,{style:{alignItems:"baseline"}},r.a.createElement($,{amount:n,isRedacted:o}),r.a.createElement(Y,{style:{width:50,textAlign:"right"}},(n/a*100).toFixed(1)+"%")))};function H(){var e=Object(m.a)(["\n  display: flex;\n  justify-content: space-between;\n  margin-top: 40px;\n  border-bottom: 2px solid #333;\n  font-size: 18px;\n  line-height: 24px;\n  padding-bottom: 5px;\n  margin-bottom: 0;\n"]);return H=function(){return e},e}var L=d.a.h2(H()),Z=function(e){var t=e.account,n=e.balance,a=e.positions,o=e.postTaxAdjustment,c=e.isRedacted,u=A("__port-is-expanded-".concat(t.number,"__"),!0),i=Object(s.a)(u,2),l=i[0],m=i[1],d=w()(a,function(e){return e.currentMarketValue*J[e.symbol].stocks})*o,p=w()(a,function(e){return e.currentMarketValue*J[e.symbol].bonds})*o,b=n.cash*o,f=d+p+b;return r.a.createElement("div",{key:t.number},r.a.createElement(L,{onClick:function(){m(!l)}},r.a.createElement("span",null,t.type),r.a.createElement($,{amount:f,isRedacted:c})),r.a.createElement(N.a,{isExpanded:l},r.a.createElement(F,null,"Positions"),a.map(function(e){return r.a.createElement(G,{key:e.symbol,label:e.symbol,amount:e.currentMarketValue*o,total:f-b,isRedacted:c})}),r.a.createElement(F,null,"Asset Classes"),r.a.createElement(G,{label:"Stocks",amount:d,total:f,isRedacted:c}),r.a.createElement(G,{label:"Bonds",amount:p,total:f,isRedacted:c}),r.a.createElement(G,{label:"Cash",amount:b,total:f,isRedacted:c})))},K=n(87),X=n.n(K);function ee(){var e=Object(m.a)(["\n  margin: 0 10px;\n"]);return ee=function(){return e},e}function te(){var e=Object(m.a)(["\n  text-align: center;\n  padding: 15px 0;\n  border-top: 1px solid #ccc;\n"]);return te=function(){return e},e}function ne(){var e=Object(m.a)(["\n  margin: 0;\n  padding: 0;\n  border: 0;\n  font-size: inherit;\n  line-height: inherit;\n  text-decoration: underline;\n  background-color: transparent;\n"]);return ne=function(){return e},e}function ae(){var e=Object(m.a)(["\n  margin-top: 0;\n  margin-bottom: 30px;\n  text-align: center;\n"]);return ae=function(){return e},e}function re(){var e=Object(m.a)(["\n  padding: 30px 30px 20px;\n  flex-grow: 1;\n  flex-shrink: 1;\n  overflow: auto;\n"]);return re=function(){return e},e}function oe(){var e=Object(m.a)(["\n  height: 100vh;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n"]);return oe=function(){return e},e}var ce="https://login.questrade.com/oauth2/authorize?client_id=".concat("YCUSnajluQMAHR32DnJhupUYJddjZQ","&response_type=token&redirect_uri=").concat("https://tomcheng.github.io/allocation-reports");!function(){var e=window.location.hash.substring(1).replace(/&/g,'","').replace(/=/g,'":"');if(!e)return C=localStorage.getItem("__port-token__"),void(I=localStorage.getItem("__port-api-server__"));var t=JSON.parse('{"'+e+'"}',function(e,t){return""===e?t:decodeURIComponent(t)});C=t.access_token,I=t.api_server,localStorage.setItem("__port-token__",C),localStorage.setItem("__port-api-server__",I),window.location.hash=""}();var ue=d.a.div(oe()),ie=d.a.div(re()),le=d.a.h1(ae()),se=d.a.button(ne()),me=d.a.div(te()),de=d.a.label(ee()),pe=function(){var e=A("__port-post-tax__",!0),t=Object(s.a)(e,2),n=t[0],o=t[1],c=A("__port-redacted__",!1),u=Object(s.a)(c,2),m=u[0],d=u[1],p=A("__port-last-updated__",null),f=Object(s.a)(p,2),v=f[0],y=f[1],x=A("__port-accounts__",null),k=Object(s.a)(x,2),O=k[0],R=k[1],C=A("__port-balances__",{}),I=Object(s.a)(C,2),V=I[0],M=I[1],B=A("__port-positions__",{}),P=Object(s.a)(B,2),q=P[0],N=P[1],U=A("__port-symbols__",{}),D=Object(s.a)(U,2),Q=D[0],W=D[1],Y=A("__port-quotes__",{}),H=Object(s.a)(Y,2),L=H[0],K=H[1],ee=function(){var e=Object(l.a)(i.a.mark(function e(){var t,n,a,r,o,c,u,l;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T();case 2:return t=e.sent,n=t.accounts,a=t.balances,r=t.positions,o=S()(h()(Object.values(r)).map(function(e){return e.symbolId})),e.next=9,z(o);case 9:c=e.sent,u=c.symbols,l=c.quotes,W(u),K(l),N(r),M(a),R(n),y((new Date).getTime());case 18:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();Object(a.useEffect)(function(){O||ee()},[]);var te=function(){var e=Object(l.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,R(null),e.next=4,ee();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),e.t0.message.includes("401")?window.location.href=ce:console.log(e.t0);case 9:case"end":return e.stop()}},e,null,[[0,6]])}));return function(){return e.apply(this,arguments)}}(),ne=(O||[]).filter(function(e){return"RRSP"===e.type}).map(function(e){return e.number}),ae=b()(Object.values(E()(q,function(e,t){return ne.includes(t)}))),re=b()(Object.values(_()(q,function(e,t){return ne.includes(t)}))),oe=Object.values(E()(V,function(e,t){return ne.includes(t)})),pe=Object.values(_()(V,function(e,t){return ne.includes(t)})),be=n?.8:1,fe={};(O||[]).forEach(function(e){var t=n&&"RRSP"===e.type?.8:1;q[e.number].forEach(function(e){fe[e.symbol]=(fe[e.symbol]||0)+e.currentMarketValue*t})});var he=j()(g()(fe,function(e,t){return{value:e,symbol:t}}),"value").reverse(),ve=w()(ae,function(e){return e.currentMarketValue*J[e.symbol].stocks})*be,ge=w()(re,function(e){return e.currentMarketValue*J[e.symbol].stocks}),ye=w()(ae,function(e){return e.currentMarketValue*J[e.symbol].bonds})*be,_e=w()(re,function(e){return e.currentMarketValue*J[e.symbol].bonds}),xe=w()(oe,"cash")*be,Ee=w()(pe,"cash"),ke=ve+ge+ye+_e+xe+Ee;return O?r.a.createElement(ue,null,r.a.createElement(ie,null,r.a.createElement(le,null,r.a.createElement($,{amount:ke,isRedacted:m})),r.a.createElement(F,null,"Positions"),he.map(function(e){var t=e.value,n=e.symbol;return r.a.createElement(G,{key:n,label:n,amount:t,total:ke-(xe+Ee),isRedacted:m})}),r.a.createElement(F,null,"Asset Classes"),r.a.createElement(G,{label:"Stocks",amount:ve+ge,total:ke,isRedacted:m}),r.a.createElement(G,{label:"Bonds",amount:ye+_e,total:ke,isRedacted:m}),r.a.createElement(G,{label:"Cash",amount:xe+Ee,total:ke,isRedacted:m}),O.map(function(e){return r.a.createElement(Z,{key:e.number,account:e,balance:V[e.number],positions:q[e.number],postTaxAdjustment:"RRSP"===e.type?be:1,symbols:Q,quotes:L,isRedacted:m})}),r.a.createElement("div",{style:{marginTop:40,textAlign:"center"}},v&&r.a.createElement("span",null,"Updated ",X()(v).fromNow(),".")," ",r.a.createElement(se,{type:"button",onClick:te},"Refresh"))),r.a.createElement(me,null,r.a.createElement(de,null,r.a.createElement("input",{type:"checkbox",checked:n,onChange:function(){o(!n)}})," ","Post tax (",20,"%)"),r.a.createElement(de,null,r.a.createElement("input",{type:"checkbox",checked:m,onChange:function(){d(!m)}})," ","Redacted"))):r.a.createElement("a",{href:ce},"Authorize")};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(pe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},90:function(e,t,n){e.exports=n(227)},95:function(e,t,n){}},[[90,1,2]]]);
//# sourceMappingURL=main.40150880.chunk.js.map