{"version":3,"sources":["repository.js","constants.js","utils.js","Account.js","App.js","authorization.js","serviceWorker.js","index.js"],"names":["getAccounts","_ref2","Object","asyncToGenerator","regenerator_default","a","mark","_callee2","_ref","accessToken","apiServer","getResource","accountsResp","accounts","positions","balances","wrap","_context2","prev","next","resource","axios","get","concat","headers","Authorization","Access-Control-Allow-Origin","sent","data","Promise","all","map","_ref3","_callee","account","_ref4","_ref5","positionsResp","balancesResp","_context","number","slicedToArray","find","combinedBalances","currency","stop","_x2","apply","this","arguments","abrupt","_x","BREAKDOWNS","VEQT.TO","stocks","bonds","VBAL.TO","VGRO.TO","formatMoney","num","toFixed","replace","formatPercent","Account","balance","sumBy","position","currentMarketValue","symbol","cash","total","react_default","createElement","key","type","window","location","hash","localStorage","getItem","search","substring","hashObject","JSON","parse","value","decodeURIComponent","setItem","access_token","api_server","getAuthorizationToken","Container","styled","div","_templateObject","App","_useState","useState","_useState2","setAccounts","_useState3","_useState4","setBalances","_useState5","_useState6","setPositions","useEffect","fetchData","isLoaded","overallStocks","flatMap","values","overallBonds","overallCash","overallTotal","react","src_Account","href","Boolean","hostname","match","ReactDOM","render","src_App","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.ce4e2eeb.chunk.js","sourcesContent":["import axios from \"axios\";\nimport find from \"lodash/find\";\n\nexport const getAccounts = async ({ accessToken, apiServer }) => {\n  const getResource = resource =>\n    axios.get(\n      `https://cors-anywhere.herokuapp.com/${apiServer}v1/${resource}`,\n      {\n        headers: {\n          Authorization: `Bearer ${accessToken}`,\n          \"Access-Control-Allow-Origin\": \"*\"\n        }\n      }\n    );\n\n  const accountsResp = await getResource(\"accounts\");\n  const accounts = accountsResp.data.accounts;\n\n  const positions = {};\n  const balances = {};\n\n  await Promise.all(\n    accounts.map(async account => {\n      const [positionsResp, balancesResp] = await Promise.all([\n        getResource(`accounts/${account.number}/positions`),\n        getResource(`accounts/${account.number}/balances`)\n      ]);\n\n      balances[account.number] = find(balancesResp.data.combinedBalances, {\n        currency: \"CAD\"\n      });\n      positions[account.number] = positionsResp.data.positions;\n    })\n  );\n\n  return { accounts, balances, positions };\n};\n","export const BREAKDOWNS = {\n  \"VEQT.TO\": {\n    stocks: 1,\n    bonds: 0\n  },\n  \"VBAL.TO\": {\n    stocks: 0.6,\n    bonds: 0.4\n  },\n  \"VGRO.TO\": {\n    stocks: 0.8,\n    bonds: 0.2\n  }\n};\n","export const formatMoney = num =>\n  \"$\" + num.toFixed(2).replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n\nexport const formatPercent = num => (num * 100).toFixed(1) + \"%\";\n","import React from \"react\";\nimport sumBy from \"lodash/sumBy\";\nimport { BREAKDOWNS } from \"./constants\";\nimport { formatMoney, formatPercent } from \"./utils\";\n\nconst Account = ({ account, balance, positions }) => {\n  const stocks = sumBy(\n    positions,\n    position => position.currentMarketValue * BREAKDOWNS[position.symbol].stocks\n  );\n  const bonds = sumBy(\n    positions,\n    position => position.currentMarketValue * BREAKDOWNS[position.symbol].bonds\n  );\n  const cash = balance.cash;\n  const total = stocks + bonds + cash;\n\n  return (\n    <div key={account.number}>\n      <div>{account.type}</div>\n      {positions.map(position => (\n        <div key={position.symbol}>\n          {position.symbol}: {formatMoney(position.currentMarketValue)}\n        </div>\n      ))}\n      <div>Cash: {formatMoney(cash)}</div>\n      <div>Breakdown</div>\n      <div>Stocks: {formatPercent(stocks / total)}</div>\n      <div>Bonds: {formatPercent(bonds / total)}</div>\n      <div>Cash: {formatPercent(cash / total)}</div>\n    </div>\n  );\n};\n\nexport default Account;\n","import React, { Fragment, useEffect, useState } from \"react\";\nimport styled from \"styled-components\";\nimport flatMap from \"lodash/flatMap\";\nimport sumBy from \"lodash/sumBy\";\nimport { getAuthorizationToken } from \"./authorization\";\nimport { getAccounts } from \"./repository\";\nimport { BREAKDOWNS } from \"./constants\";\nimport Account from \"./Account\";\nimport { formatMoney, formatPercent } from \"./utils\";\n\nconst CLIENT_ID = \"YCUSnajluQMAHR32DnJhupUYJddjZQ\";\nconst REDIRECT_URI = \"https://tomcheng.github.io/allocation-reports\";\n\nconst { accessToken, apiServer } = getAuthorizationToken();\n\nconst Container = styled.div`\n  padding: 20px 30px;\n`;\n\nconst App = () => {\n  const [accounts, setAccounts] = useState(null);\n  const [balances, setBalances] = useState({});\n  const [positions, setPositions] = useState({});\n\n  useEffect(() => {\n    const fetchData = async () => {\n      const { accounts, balances, positions } = await getAccounts({\n        accessToken,\n        apiServer\n      });\n\n      setPositions(positions);\n      setBalances(balances);\n      setAccounts(accounts);\n    };\n\n    fetchData();\n  }, []);\n\n  const isLoaded = !!accounts;\n\n  const overallStocks = sumBy(\n    flatMap(Object.values(positions)),\n    position => position.currentMarketValue * BREAKDOWNS[position.symbol].stocks\n  );\n  const overallBonds = sumBy(\n    flatMap(Object.values(positions)),\n    position => position.currentMarketValue * BREAKDOWNS[position.symbol].bonds\n  );\n  const overallCash = sumBy(Object.values(balances), \"cash\");\n  const overallTotal = overallStocks + overallBonds + overallCash;\n\n  return (\n    <Container>\n      {isLoaded ? (\n        <Fragment>\n          <div>Overall Breakdown</div>\n          <div>Total: {formatMoney(overallTotal)}</div>\n          <div>Stocks: {formatPercent(overallStocks / overallTotal)}</div>\n          <div>Bonds: {formatPercent(overallBonds / overallTotal)}</div>\n          <div>Cash: {formatPercent(overallCash / overallTotal)}</div>\n          {accounts.map(account => (\n            <Account\n              key={account.number}\n              account={account}\n              balance={balances[account.number]}\n              positions={positions[account.number]}\n            />\n          ))}\n        </Fragment>\n      ) : (\n        <a\n          href={`https://login.questrade.com/oauth2/authorize?client_id=${CLIENT_ID}&response_type=token&redirect_uri=${REDIRECT_URI}`}\n        >\n          Authorize\n        </a>\n      )}\n      <div>v 0.0.4</div>\n    </Container>\n  );\n};\n\nexport default App;\n","const ACCESS_TOKEN_STORAGE_KEY = \"questrade_access_token\";\n\nexport const getAuthorizationToken = () => {\n  // check for hash route\n  if (window.location.hash[1] === \"/\") {\n    return localStorage.getItem(ACCESS_TOKEN_STORAGE_KEY);\n  }\n\n  const search = window.location.hash\n    .substring(1)\n    .replace(/&/g, '\",\"')\n    .replace(/=/g, '\":\"');\n\n  if (!search) {\n    return localStorage.getItem(ACCESS_TOKEN_STORAGE_KEY);\n  }\n\n  const hashObject = JSON.parse('{\"' + search + '\"}', (key, value) =>\n    key === \"\" ? value : decodeURIComponent(value)\n  );\n\n  localStorage.setItem(ACCESS_TOKEN_STORAGE_KEY, hashObject.access_token);\n  // window.location.hash = \"\";\n\n  return {\n    accessToken: hashObject.access_token,\n    apiServer: hashObject.api_server\n  };\n};\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}