(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{226:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),o=n(29),c=n.n(o),u=(n(92),n(3)),s=n.n(u),l=n(12),i=n(1),m=n(5),p=n(6),b=n(43),f=n.n(b),d=n(80),v=n.n(d),h=n(44),y=n.n(h),_=n(30),g=n.n(_),k=n(7),x=n.n(k),j=n(81),E=n.n(j),O=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=Object(a.useState)(function(){try{var n=localStorage.getItem(t);return n?JSON.parse(n):e}catch(a){return e}}),r=Object(i.a)(n,2),o=r[0],c=r[1];return[o,function(e){try{c(e),localStorage.setItem(t,JSON.stringify(e))}catch(n){console.log(n)}}]},w=null,S=null,A=n(82),I=n.n(A),V=n(31),C=n.n(V),M=n(45),R=n.n(M),q=function(t){return I.a.get("https://cors-anywhere.herokuapp.com/".concat(S,"v1/").concat(t),{headers:{Authorization:"Bearer ".concat(w),"Access-Control-Allow-Origin":"*"}})},B=function(){var t=Object(l.a)(s.a.mark(function t(){var e,n,a,r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,q("accounts");case 2:return e=t.sent,n=e.data.accounts,a={},r={},t.next=8,Promise.all(n.map(function(){var t=Object(l.a)(s.a.mark(function t(e){var n,o,c,u;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([q("accounts/".concat(e.number,"/positions")),q("accounts/".concat(e.number,"/balances"))]);case 2:n=t.sent,o=Object(i.a)(n,2),c=o[0],u=o[1],r[e.number]=C()(u.data.combinedBalances,{currency:"CAD"}),a[e.number]=R()(c.data.positions,function(t){return-t.currentMarketValue});case 8:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()));case 8:return t.abrupt("return",{accounts:R()(n,function(t){return-r[t.number].totalEquity}),balances:r,positions:a});case 9:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}(),P=function(){var t=Object(l.a)(s.a.mark(function t(e){var n,a,r,o,c,u;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={},a={},t.next=4,Promise.all([q("symbols?ids=".concat(e.join(","))),q("markets/quotes?ids=".concat(e.join(",")))]);case 4:return r=t.sent,o=Object(i.a)(r,2),c=o[0],u=o[1],e.forEach(function(t){n[t]=C()(c.data.symbols,{symbolId:t}),a[t]=C()(u.data.quotes,{symbolId:t})}),t.abrupt("return",{symbols:n,quotes:a});case 10:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),J={"VEQT.TO":{stocks:1,bonds:0},"VGRO.TO":{stocks:.8,bonds:.2},"VBAL.TO":{stocks:.6,bonds:.4}};function T(){var t=Object(m.a)(["\n  line-height: 16px;\n  font-size: 12px;\n  color: #666;\n"]);return T=function(){return t},t}function z(){var t=Object(m.a)(["\n  display: flex;\n  justify-content: space-between;\n"]);return z=function(){return t},t}function N(){var t=Object(m.a)(["\n  font-weight: bold;\n  font-size: 12px;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n  border-bottom: 1px solid #ddd;\n  margin-bottom: 5px;\n  margin-top: 15px;\n"]);return N=function(){return t},t}var U=p.a.div(N()),D=p.a.div(z()),Q=p.a.div(T()),F=function(t){return"$"+Math.round(t).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g,",")},L=function(t){var e=t.label,n=t.amount,a=t.total;return r.a.createElement(D,{style:{marginBottom:3}},r.a.createElement("div",null,r.a.createElement("div",null,e)),r.a.createElement(D,{style:{alignItems:"baseline"}},r.a.createElement("div",null,F(n)),r.a.createElement(Q,{style:{width:50,textAlign:"right"}},(n/a*100).toFixed(1)+"%")))};function W(){var t=Object(m.a)(["\n  margin-top: 30px;\n  margin-bottom: 10px;\n"]);return W=function(){return t},t}var Y=p.a.h2(W()),$=function(t){var e=t.account,n=t.balance,a=t.positions,o=t.postTaxAdjustment,c=x()(a,function(t){return t.currentMarketValue*J[t.symbol].stocks})*o,u=x()(a,function(t){return t.currentMarketValue*J[t.symbol].bonds})*o,s=n.cash*o,l=c+u+s;return r.a.createElement("div",{key:e.number},r.a.createElement(Y,null,e.type),r.a.createElement(U,null,"Asset Classes"),r.a.createElement(L,{label:"Stocks",amount:c,total:l}),r.a.createElement(L,{label:"Bonds",amount:u,total:l}),r.a.createElement(L,{label:"Cash",amount:s,total:l}),r.a.createElement(U,null,"Positions"),a.map(function(t){return r.a.createElement(L,{key:t.symbol,label:t.symbol,amount:t.currentMarketValue*o,total:l-s})}))},G=n(85),H=n.n(G);function Z(){var t=Object(m.a)(["\n  text-align: center;\n  margin-top: 20px;\n  margin-bottom: 20px;\n"]);return Z=function(){return t},t}function K(){var t=Object(m.a)(["\n  display: flex;\n  justify-content: space-between;\n"]);return K=function(){return t},t}function X(){var t=Object(m.a)(["\n  padding: 20px 30px;\n"]);return X=function(){return t},t}var tt="https://login.questrade.com/oauth2/authorize?client_id=".concat("YCUSnajluQMAHR32DnJhupUYJddjZQ","&response_type=token&redirect_uri=").concat("https://tomcheng.github.io/allocation-reports");!function(){var t=window.location.hash.substring(1).replace(/&/g,'","').replace(/=/g,'":"');if(!t)return w=localStorage.getItem("__port-token__"),void(S=localStorage.getItem("__port-api-server__"));var e=JSON.parse('{"'+t+'"}',function(t,e){return""===t?e:decodeURIComponent(e)});w=e.access_token,S=e.api_server,localStorage.setItem("__port-token__",w),localStorage.setItem("__port-api-server__",S),window.location.hash=""}();var et=p.a.div(X()),nt=p.a.div(K()),at=p.a.h1(Z()),rt=function(){var t=O("__port-post-tax__",!0),e=Object(i.a)(t,2),n=e[0],o=e[1],c=O("__port-last-updated__",null),u=Object(i.a)(c,2),m=u[0],p=u[1],b=O("__port-accounts__",null),d=Object(i.a)(b,2),h=d[0],_=d[1],k=O("__port-balances__",{}),j=Object(i.a)(k,2),w=j[0],S=j[1],A=O("__port-positions__",{}),I=Object(i.a)(A,2),V=I[0],C=I[1],M=O("__port-symbols__",{}),R=Object(i.a)(M,2),q=R[0],T=R[1],z=O("__port-quotes__",{}),N=Object(i.a)(z,2),D=N[0],Q=N[1],W=function(){var t=Object(l.a)(s.a.mark(function t(){var e,n,a,r,o,c,u,l;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,B();case 2:return e=t.sent,n=e.accounts,a=e.balances,r=e.positions,o=E()(v()(Object.values(r)).map(function(t){return t.symbolId})),t.next=9,P(o);case 9:c=t.sent,u=c.symbols,l=c.quotes,T(u),Q(l),C(r),S(a),_(n),p((new Date).getTime());case 18:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}();Object(a.useEffect)(function(){h||W()},[]);var Y=function(){var t=Object(l.a)(s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,_(null),t.next=4,W();case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),t.t0.message.includes("401")?window.location.href=tt:console.log(t.t0);case 9:case"end":return t.stop()}},t,null,[[0,6]])}));return function(){return t.apply(this,arguments)}}(),G=(h||[]).filter(function(t){return"RRSP"===t.type}).map(function(t){return t.number}),Z=f()(Object.values(g()(V,function(t,e){return G.includes(e)}))),K=f()(Object.values(y()(V,function(t,e){return G.includes(e)}))),X=Object.values(g()(w,function(t,e){return G.includes(e)})),rt=Object.values(y()(w,function(t,e){return G.includes(e)})),ot=n?.8:1,ct=x()(Z,function(t){return t.currentMarketValue*J[t.symbol].stocks})*ot,ut=x()(K,function(t){return t.currentMarketValue*J[t.symbol].stocks}),st=x()(Z,function(t){return t.currentMarketValue*J[t.symbol].bonds})*ot,lt=x()(K,function(t){return t.currentMarketValue*J[t.symbol].bonds}),it=x()(X,"cash")*ot,mt=x()(rt,"cash"),pt=ct+ut+st+lt+it+mt;return h?r.a.createElement(et,null,r.a.createElement(nt,null,r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",checked:n,onChange:function(){o(!n)}})," ","Post tax (",20,"%)"),r.a.createElement("div",null,m&&r.a.createElement("span",null,"Last Updated ",H()(m).fromNow())," ",r.a.createElement("button",{type:"button",onClick:Y},"Refresh"))),r.a.createElement(at,null,F(pt)),r.a.createElement(U,null,"Accounts"),h.map(function(t){return r.a.createElement(L,{key:t.number,label:t.type,amount:w[t.number].totalEquity*("RRSP"===t.type?ot:1),total:pt})}),r.a.createElement(U,null,"Asset Classes"),r.a.createElement(L,{label:"Stocks",amount:ct+ut,total:pt}),r.a.createElement(L,{label:"Bonds",amount:st+lt,total:pt}),r.a.createElement(L,{label:"Cash",amount:it+mt,total:pt}),h.map(function(t){return r.a.createElement($,{key:t.number,account:t,balance:w[t.number],positions:V[t.number],postTaxAdjustment:"RRSP"===t.type?ot:1,symbols:q,quotes:D})})):r.a.createElement("a",{href:tt},"Authorize")};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(rt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})},87:function(t,e,n){t.exports=n(226)},92:function(t,e,n){}},[[87,1,2]]]);
//# sourceMappingURL=main.3b5fbf13.chunk.js.map